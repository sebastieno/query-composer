<script type="text/html" id="queryComposerTemplate">
    <ul data-bind="foreach: queries" class="queries">
        <li data-bind="css: { or: operator() === '||', and: operator() === '&&' }">
            <span class="query">
                <select class="query-field-operator" data-bind="visible: $index() > 0,
                options: $parent.operators,
                optionsText: 'name',
                value: operator,
                optionsValue: 'value'"></select>

                <select class="query-field-type" data-bind="options: $parent.fieldsDefinition,
                       optionsText: 'text',
                       value: field,
                       optionsCaption: 'Sélectionnez un type de champ...'"></select>

                <input type="hidden" data-bind="attr : { name: 'queries[' + $index() + '].type' }, value: field() ? field().type : ''" />
                <input type="hidden" data-bind="attr : { name: 'queries[' + $index() + '].field' }, value: field() ? field().name : ''" />
                <input type="hidden" data-bind="attr : { name: 'queries[' + $index() + '].value' }, value: value" />
                <input type="hidden" data-bind="attr : { name: 'queries[' + $index() + '].operator' }, value: operator" />

                <!-- ko if: field() -->
                <!-- ko template: 'queryComposerFieldDefinition' +  field().type + 'Template' -->
                <!-- /ko -->
                <!-- /ko -->
            </span>
            <span class="action-buttons">
                <button type="button" class="query-btn" data-bind="click: function() { $parent.goDown($data); }, disable: $index() >= ($parent.queries().length - 1)">
                    down
                </button>
                <button type="button" class="query-btn" data-bind="click: function() { $parent.goUp($data); }, enable: $index() != 0">
                    up
                </button>
                <button type="button" class="query-btn" data-bind="click: function() { $parent.removeQuery($data); }">
                    x
                </button>
            </span>

            <!-- ko if: field() -->
            <!-- ko template: 'queryComposerSubQueries' -->
            <!-- /ko -->
            <!-- /ko -->
        </li>
    </ul>
    <button type="button" data-bind="click: addQuery">
        +
    </button>
</script>

<script type="text/html" id="queryComposerFieldDefinition0Template">
    =
    <input class="query-field-value" type="text" data-bind="value: value" />
</script>

<script type="text/html" id="queryComposerFieldDefinition1Template">
    =
    <select class="query-field-value" data-bind="options: field().values,
                       optionsText: 'text',
                       optionsValue: 'value',
                       value: value,
                       optionsCaption: 'Sélectionnez une valeur...'"></select>
</script>

<script type="text/html" id="queryComposerFieldDefinition2Template">
    <!-- ko template: 'queryComposerFieldDefinition' +  field().mainField.type + 'Template' -->
    <!-- /ko -->
</script>

<script type="text/html" id="queryComposerSubQueries">
    <div data-bind="if: field().subQueries">
        <ul data-bind="foreach: field().subQueries" class="query-subqueries">
            <li class="query-subquery">
                <input type="hidden" data-bind="attr : { name: 'queries[' + $parentContext.$index() + '].subValues[' + $index() + '].type' }, value: field() ? field().type : ''" />
                <input type="hidden" data-bind="attr : { name: 'queries[' + $parentContext.$index() + '].subQueries[' + $index() + '].field' }, value: field() ? field().name : ''" />
                <input type="hidden" data-bind="attr : { name: 'queries[' + $parentContext.$index() + '].subQueries[' + $index() + '].value' }, value: value" />
                <input type="hidden" data-bind="attr : { name: 'queries[' + $parentContext.$index() + '].subQueries[' + $index() + '].operator' }, value: operator" />

                <span data-bind="text: field().text"></span>
                <!-- ko template: 'queryComposerFieldDefinition' +  field().type + 'Template' -->
                <!-- /ko -->
            </li>
        </ul>
    </div>
</script>
